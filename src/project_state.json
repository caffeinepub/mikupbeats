{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 46,
  "summary": "MikupBeats is a full-stack Internet Computer (Motoko canister) + React web platform for selling and licensing music beats, featuring Internet Identity authentication (guest browsing supported), admin-controlled content management (beats with editable metadata and rights packages, featured beat spotlight, showcases, mixtapes/albums, milestones, live schedule with upcoming shows & replays, licenses, music links, M.v.A brand page), Stripe-powered checkout, secure post-purchase delivery via rights ZIP downloads (with sold-rights locking and admin reopen) and optional Google Drive delivery (in progress), a community forum with admin-created sections and public posting (optionally link-sharing per section), a public Music Links/releases hub (admin-managed), shareable beat links, global unified audio playback, and an admin analytics dashboard for site visits.",
  "architectural_notes": [
    "Backend is a single Motoko canister (backend/main.mo) exposing Candid methods consumed by the frontend via an autogenerated TypeScript actor interface.",
    "Role-based access control is implemented server-side (admin/user/guest) via authorization/access-control.mo and mixed into the canister via MixinAuthorization.mo; many endpoints trap on unauthorized access.",
    "Frontend uses TanStack React Query for data fetching/mutations with explicit cache invalidation patterns; TanStack Router provides SPA routing.",
    "Authentication uses Internet Identity (AuthClient) with long-lived delegation; the app supports anonymous (guest) browsing by creating an anonymous actor when not authenticated.",
    "Actor initialization (useActor) calls a backend initialization method (_initializeAccessControlWithSecret) on authenticated sessions, using an admin token optionally supplied via URL hash and persisted in sessionStorage.",
    "Media is stored as ExternalBlob references and delivered via getDirectURL/getBytes methods; backend includes Caffeine blob-storage mixins for gateway authorization and dead-blob pruning.",
    "Stripe integration is implemented in Motoko via HTTPS outcalls (ic:aaaaa-aa http_request) with a transform function to strip headers; Stripe checkout session creation and status checking are handled server-side.",
    "Global unified audio playback is implemented via a React context that owns a single <audio> element, ensuring only one preview/track plays at a time across the app.",
    "UI is built with Tailwind + shadcn/radix primitives; the theme enforces opaque overlays and a purple/grey palette using CSS variables and custom animations.",
    "Beat records now persist across deployments via stable storage (stable backing array + preupgrade/postupgrade rehydration) so Store/Admin listings survive upgrades."
  ],
  "known_issues": [
    "YouTube live URL management is not implemented in the backend: useGetYouTubeLiveUrl always returns null, and set/delete hooks throw errors; Admin YouTube config UI cannot persist data.",
    "Stripe purchase flow appears incorrect on the frontend: BeatCard/BeatDetailsPage generate a fake sessionId and call recordBeatPurchase before redirecting to Stripe. The backend validates paid purchases by querying Stripe using the real session ID; this will likely fail in production.",
    "Backend createCheckoutSession always includes client_reference_id = caller principal. For anonymous/guest callers this can cause paid purchases to be recorded under the anonymous principal (not the guest session), breaking guest access paths.",
    "Stripe checkout body builder uses shipping_address_collection[allowed_countries][0] for every country (index not incremented), likely resulting in only one allowed country being applied.",
    "Analytics implementation is incomplete: uniqueVisitors is never updated and dailyVisits is reset to [] on every visit, so trend charts will show no historical data.",
    "ForumPage computes isAdmin as identity !== null (any authenticated user), but backend restricts create/delete sections to admins; UI may expose admin-only controls to non-admin users.",
    "LiveShowsManagement uses index-derived IDs (e.g., show-0, replay-0) for edit/delete, but creation uses time-based IDs (e.g., show-<Date.now()>). Edit/delete likely fail after creation.",
    "MilestoneManagement similarly uses index-derived IDs for edit/delete (milestone-<index>) rather than the stored IDs, so edit/delete may fail or target the wrong record.",
    "blob-storage/Storage.mo references environment variables CAFFFEINE_STORAGE_CASHIER_PRINCIPAL (misspelling: CAFFFEINE) which may be misconfigured and cause runtime traps.",
    "License documents are not actually being bundled into ZIP deliveries: downloads (including free Basic) only fetch and download the existing rights ZIP as-is (via getRightsZipFile) and do not fetch/merge the matching stored license PDF, so buyers do not receive the license file with their beat download."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "IF-1",
      "title": "Internet Identity authentication (optional login) with persistent sessions",
      "synonyms": [
        "II login",
        "AuthClient login/logout",
        "delegation identity"
      ],
      "description": "Provides Internet Identity login/logout, loads existing authenticated identity on app start, and manages login status states (initializing/idle/logging-in/success/error).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-2",
      "title": "Backend actor initialization with authenticated/anonymous modes",
      "synonyms": [
        "useActor",
        "anonymous actor",
        "authenticated actor"
      ],
      "description": "Creates an anonymous backend actor for guests and an identity-backed actor for authenticated users; reinitializes and invalidates/refetches dependent React Query caches when identity changes.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-3",
      "title": "Access control initialization via secret admin token",
      "synonyms": [
        "_initializeAccessControlWithSecret",
        "admin token bootstrap"
      ],
      "description": "On authenticated actor creation, calls a backend initializer that compares a user-provided token against an environment-stored CAFFEINE_ADMIN_TOKEN to optionally assign the first admin role.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-4",
      "title": "Role-based authorization (admin/user/guest) and role assignment",
      "synonyms": [
        "RBAC",
        "isCallerAdmin",
        "assign role"
      ],
      "description": "Motoko access-control module enforces permissions for admin-only and user-only endpoints; includes endpoints to query caller role and assign roles (admin-only).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-5",
      "title": "Creator approval workflow",
      "synonyms": [
        "request approval",
        "approval management",
        "isCallerApproved"
      ],
      "description": "Authenticated users can request approval; admins can list approvals and set approval status (approved/rejected/pending). Approval is required for submitting showcases/mixtapes (unless admin).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-6",
      "title": "User profiles (caller profile get/save) with onboarding prompt",
      "synonyms": [
        "ProfileSetup dialog",
        "Account setup page"
      ],
      "description": "Stores user profile (name, isCreator) keyed by principal; frontend prompts new authenticated users to complete profile and offers an account setup page for updates.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-7",
      "title": "Beat catalog data model and admin CRUD",
      "synonyms": [
        "uploadBeat",
        "updateBeat",
        "deleteBeat",
        "getBeat"
      ],
      "description": "Admins can upload, update, and delete beats with metadata (category/style/texture), cover art, preview media, rights folders, and delivery method; public endpoints list beats and fetch a single beat by ID.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-8",
      "title": "Beat filtering endpoint and store browsing filters/search",
      "synonyms": [
        "filterBeats",
        "store filters",
        "search beats"
      ],
      "description": "Backend supports filtering beats by optional category/style/texture; frontend store page offers category/style/texture dropdowns plus title/artist search and scroll-position persistence.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-9",
      "title": "Rights folders with sold-state enforcement and admin reopening",
      "synonyms": [
        "rights licensing",
        "sold flag",
        "unmarkRightsAsSold"
      ],
      "description": "Each beat contains multiple rights folders (basic/premium/exclusive/stems) with price, freeDownload, and sold status. Purchases mark a rights type as sold; admins can unmark a rights type to reopen it for sale.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-10",
      "title": "Dual delivery methods: ZIP download or Google Drive link",
      "synonyms": [
        "DeliveryMethod.zipFiles",
        "DeliveryMethod.googleDrive"
      ],
      "description": "Beats can deliver purchased content either as a stored ZIP ExternalBlob (download via getRightsZipFile) or as a stored Google Drive URL (retrieved via getGoogleDriveLink), with access checks for admin/auth/guest sessions.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-11",
      "title": "Stripe configuration and server-side checkout session creation/status",
      "synonyms": [
        "StripeConfigSection",
        "setStripeConfiguration",
        "createCheckoutSession"
      ],
      "description": "Admins can store Stripe secret key and allowed countries; backend creates Stripe checkout sessions via HTTP outcalls and can query session status for verification.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-12",
      "title": "Purchase recording and purchase history retrieval",
      "synonyms": [
        "recordBeatPurchase",
        "getPurchaseHistory",
        "guest sessions"
      ],
      "description": "Backend records purchases for authenticated users and stores guest purchases by session ID; authenticated users can query their purchase history. Frontend purchase history page supports delivery-method-aware downloads (ZIP bytes download or opening Drive link).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-13",
      "title": "Featured beat selection and display",
      "synonyms": [
        "getFeaturedBeat",
        "setFeaturedBeat",
        "clearFeaturedBeat"
      ],
      "description": "Admins can set/clear a featured beat; store page shows a prominent featured beat card with preview playback and navigation to beat details.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-14",
      "title": "Showcase submissions with moderation",
      "synonyms": [
        "submitShowcase",
        "approveShowcase",
        "pending showcases"
      ],
      "description": "Approved creators (or admin) can submit showcases (audio + cover art + metadata + optional beat reference + optional external link). Admins can approve, bulk-approve, or delete submissions; public showcase page lists approved entries.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-15",
      "title": "Showcase highlights sourced from mixtapes",
      "synonyms": [
        "ShowcaseHighlight",
        "setShowcaseHighlight"
      ],
      "description": "Admins can designate a highlighted song from an approved mixtape to appear as a special card on the showcase page, with unified audio playback and navigation to the mixtapes page.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-16",
      "title": "Mixtape submissions, approvals, and public mixtape gallery",
      "synonyms": [
        "submitMixtape",
        "approveMixtape",
        "rejectMixtape",
        "mixtapes page"
      ],
      "description": "Authenticated approved users can submit mixtapes (title, description, cover, up to 20 audio tracks, external links). Admins approve/reject; approved mixtapes appear in a public searchable grid with per-mixtape track playback.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-17",
      "title": "Mixtape submission fee configuration (Stripe-gated)",
      "synonyms": [
        "MixtapeSubmissionFeeConfig",
        "paid submissions"
      ],
      "description": "Admins can enable/disable a submission fee and set price in cents; backend enforces Stripe payment completion for non-admin submitters when enabled.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-18",
      "title": "Official music links directory with admin CRUD",
      "synonyms": [
        "MusicLinksPage",
        "add/update/delete music link"
      ],
      "description": "Public page lists official music release links with optional cover art and release date; admins can add, edit, and delete entries across multiple platforms (Spotify/Apple Music/YouTube/SoundCloud/Other).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-19",
      "title": "M.v.A preview asset management and public playback",
      "synonyms": [
        "uploadMvaPreview",
        "getMvaPreview",
        "deleteMvaPreview"
      ],
      "description": "Admins can upload/delete an M.v.A preview media asset; the M.v.A page can play the current preview via the unified audio player and includes brand/description content.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-20",
      "title": "Live content: upcoming shows and replay management",
      "synonyms": [
        "upcoming shows",
        "replays",
        "live schedule"
      ],
      "description": "Public Live page displays upcoming shows and replay links; admin panel provides create/update/delete dialogs for both upcoming shows and replays.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-21",
      "title": "Community forum with admin-managed chat rooms and real-time message refresh",
      "synonyms": [
        "sections",
        "messages",
        "chat rooms",
        "link sharing"
      ],
      "description": "Admins can create/delete forum sections (chat rooms) and toggle link sharing per section; authenticated users can post messages; section detail pages auto-refresh every 3 seconds, scroll to newest messages, and optionally render URLs as sanitized clickable links.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-22",
      "title": "Timeline milestones: backend storage, interactive display, and admin CRUD",
      "synonyms": [
        "milestones",
        "InteractiveTimeline"
      ],
      "description": "Admins can create/update/delete milestones with optional media and ordering; public login page displays an interactive timeline (horizontal scroll on desktop, vertical stack on mobile).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-23",
      "title": "Rights license document stores (Basic/Premium/Exclusive/Stems)",
      "synonyms": [
        "license management",
        "upload rights licenses"
      ],
      "description": "Admins can upload/download/delete separate license documents for each rights tier; frontend provides management panels for each document type.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-24",
      "title": "Admin analytics collection and dashboard",
      "synonyms": [
        "recordSiteVisit",
        "getAnalytics"
      ],
      "description": "Backend records total visit count and per-page counters; admin dashboard displays summary counts and (intended) trend visualization, and several pages record visits on mount.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-25",
      "title": "Unified global audio player for previews and tracks",
      "synonyms": [
        "AudioPlayerContext",
        "single audio element playback"
      ],
      "description": "Provides play/pause/stop across the app using a shared <audio> element, enabling consistent playback controls across beat previews, showcases, mixtapes, and M.v.A preview.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-26",
      "title": "Responsive navigation UI (hamburger menu + bottom quick links)",
      "synonyms": [
        "HamburgerMenu",
        "QuickLinkBar"
      ],
      "description": "Implements a slide-out navigation menu and a fixed bottom navigation bar; includes conditional admin link visibility when isCallerAdmin is true.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-27",
      "title": "Blob storage gateway authorization & maintenance hooks (Caffeine storage mixin)",
      "synonyms": [
        "_caffeineStorageUpdateGatewayPrincipals",
        "dead blob pruning"
      ],
      "description": "Includes backend mixin endpoints for updating authorized storage gateway principals, checking live blobs, retrieving dead blobs, confirming deletion, and refilling cashier cycles.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "feature-update-the-paid-rights-purchase-flow-in-the-beat-listing-card-so-it-does-not-call-recordbeatpurchase-before-the-user-completes-stripe-checkout-instead-1-create-the-stripe-checkout-session-via-createcheckoutsession-2-redirect-the-browser-to-stripe-using-the-returned-checkout-url-and-3-do-not-mark-the-beat-as-purchased-until-the-app-returns-from-stripe-success",
      "title": "Update the paid-rights purchase flow in the beat listing card so it does NOT call `recordBeatPurchase` before the user completes Stripe Checkout. Instead: (1) create the Stripe Checkout session via `createCheckoutSession`, (2) redirect the browser to Stripe using the returned Checkout URL, and (3) do not mark the beat as purchased until the app returns from Stripe success.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-paid-rights-purchase-flow-in-the-beat-details-page-so-it-does-not-call-recordbeatpurchase-before-the-user-completes-stripe-checkout-the-behavior-must-match-the-corrected-beat-card-flow-create-stripe-checkout-session-redirect-to-stripe-and-defer-purchase-recording-until-after-stripe-success-return",
      "title": "Update the paid-rights purchase flow in the beat details page so it does NOT call `recordBeatPurchase` before the user completes Stripe Checkout. The behavior must match the corrected beat card flow: create Stripe checkout session, redirect to Stripe, and defer purchase recording until after Stripe success return.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-stripe-success-redirects-back-with-the-real-stripe-checkout-session-id-and-record-the-paid-purchase-only-after-that-redirect-update-the-successurl-passed-into-createcheckoutsession-so-stripe-includes-the-session-id-in-the-return-url-stripe-placeholder-checkout-session-id-and-implement-client-side-handling-on-the-return-page-to-call-recordbeatpurchase-beatid-sessionid-false-rightstype-using-that-real-session-id",
      "title": "Ensure Stripe success redirects back with the REAL Stripe Checkout session id, and record the paid purchase only after that redirect. Update the `successUrl` passed into `createCheckoutSession` so Stripe includes the session id in the return URL (Stripe placeholder `{CHECKOUT_SESSION_ID}`), and implement client-side handling on the return page to call `recordBeatPurchase(beatId, sessionId, false, rightsType)` using that real session id.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-local-purchase-tracking-for-paid-purchases-so-it-stores-the-real-stripe-session-id-from-the-stripe-success-redirect-rather-than-a-generated-fake-id-if-a-temporary-pending-local-record-is-created-before-redirect-it-must-be-updated-replaced-after-success-with-the-real-session-id-so-downloads-verification-use-the-correct-identifier",
      "title": "Fix local purchase tracking for paid purchases so it stores the real Stripe session id (from the Stripe success redirect) rather than a generated fake id. If a temporary/pending local record is created before redirect, it must be updated/replaced after success with the real `session_id` so downloads/verification use the correct identifier.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-retry-the-build-and-deployment-for-the-current-project-if-deployment-fails-again-capture-and-present-the-complete-deployment-build-error-output-including-any-canister-compilation-install-upgrade-or-asset-upload-errors-so-the-failure-is-actionable-to-debug",
      "title": "Retry the build and deployment for the current project. If deployment fails again, capture and present the complete deployment/build error output (including any canister compilation, install/upgrade, or asset upload errors) so the failure is actionable to debug.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-paid-rights-purchase-flow-in-the-beat-listing-card-frontend-src-components-beatcard-tsx-so-it-does-not-call-recordbeatpurchase-before-the-user-completes-stripe-checkout-instead-on-paid-purchase-1-call-createcheckoutsession-2-redirect-the-browser-to-stripe-using-the-returned-checkout-url-and-3-defer-recordbeatpurchase-until-after-the-app-returns-from-stripe-success",
      "title": "Update the paid-rights purchase flow in the beat listing card (frontend/src/components/BeatCard.tsx) so it does NOT call `recordBeatPurchase` before the user completes Stripe Checkout. Instead, on paid purchase: (1) call `createCheckoutSession`, (2) redirect the browser to Stripe using the returned Checkout URL, and (3) defer `recordBeatPurchase` until after the app returns from Stripe success.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-paid-rights-purchase-flow-in-the-beat-details-page-frontend-src-pages-beatdetailspage-tsx-so-it-matches-the-corrected-beatcard-flow-for-paid-purchases-call-createcheckoutsession-redirect-to-stripe-using-the-returned-url-and-do-not-call-recordbeatpurchase-until-after-stripe-success-return",
      "title": "Update the paid-rights purchase flow in the beat details page (frontend/src/pages/BeatDetailsPage.tsx) so it matches the corrected BeatCard flow: for paid purchases, call `createCheckoutSession`, redirect to Stripe using the returned URL, and do not call `recordBeatPurchase` until after Stripe success return.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-stripe-success-redirects-back-with-the-real-stripe-checkout-session-id-and-only-then-record-the-paid-purchase-specifically-update-the-successurl-passed-into-createcheckoutsession-so-stripe-includes-the-session-id-in-the-return-url-using-the-stripe-placeholder-checkout-session-id-e-g-session-id-checkout-session-id-and-implement-client-side-handling-on-the-return-page-to-call-recordbeatpurchase-beatid-sessionid-false-rightstype-using-that-real-session-id",
      "title": "Ensure Stripe success redirects back with the REAL Stripe Checkout session id, and only then record the paid purchase. Specifically: update the `successUrl` passed into `createCheckoutSession` so Stripe includes the session id in the return URL using the Stripe placeholder `{CHECKOUT_SESSION_ID}` (e.g., `...&session_id={CHECKOUT_SESSION_ID}`), and implement client-side handling on the return page to call `recordBeatPurchase(beatId, sessionId, false, rightsType)` using that real session id.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-local-purchase-tracking-for-paid-purchases-so-it-stores-the-real-stripe-session-id-from-the-stripe-success-redirect-rather-than-a-generated-fake-id-if-a-temporary-pending-local-record-is-created-before-redirect-it-must-be-updated-replaced-after-success-with-the-real-session-id-so-downloads-verification-use-the-correct-identifier-2",
      "title": "Fix local purchase tracking for paid purchases so it stores the real Stripe session id from the Stripe success redirect rather than a generated fake id. If a temporary/pending local record is created before redirect, it must be updated/replaced after success with the real `session_id` so downloads/verification use the correct identifier.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-stripe-checkout-successurl-and-cancelurl-used-for-paid-purchases-so-stripe-always-redirects-to-an-existing-static-path-the-site-root-instead-of-spa-deep-links-like-purchase-history-or-beat-id-while-still-including-beatid-rightstype-and-session-id-checkout-session-id-in-the-return-url-query-string",
      "title": "Update the Stripe Checkout `successUrl` and `cancelUrl` used for paid purchases so Stripe always redirects to an existing static path (the site root `/`) instead of SPA deep links like `/purchase-history` or `/beat/<id>`, while still including `beatId`, `rightsType`, and `session_id={CHECKOUT_SESSION_ID}` in the return URL query string.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-global-stripe-return-handler-at-the-app-entry-layout-level-that-detects-beatid-rightstype-and-session-id-in-the-current-url-when-the-app-loads-on-then-navigates-the-user-to-purchase-history-client-side-with-those-same-query-parameters-so-the-existing-purchasehistorypage-logic-can-finalize-and-record-the-purchase",
      "title": "Add a global Stripe return handler at the app entry/layout level that detects `beatId`, `rightsType`, and `session_id` in the current URL when the app loads on `/`, then navigates the user to `/purchase-history` (client-side) with those same query parameters so the existing `PurchaseHistoryPage` logic can finalize and record the purchase.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-stripe-return-processing-remains-idempotent-and-continues-to-a-call-recordbeatpurchase-beatid-sessionid-false-rightstype-only-after-stripe-redirects-back-with-a-real-session-id-and-b-finalize-local-purchase-tracking-with-the-real-stripe-session-id-with-clear-user-facing-error-messaging-when-finalization-fails",
      "title": "Ensure the Stripe return processing remains idempotent and continues to (a) call `recordBeatPurchase(beatId, sessionId, false, rightsType)` only after Stripe redirects back with a real `session_id`, and (b) finalize local purchase tracking with the real Stripe `session_id`, with clear user-facing error messaging when finalization fails.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-handle-stripe-success-return-parameters-beatid-rightstype-session-id-even-when-the-user-is-not-authenticated-so-the-stripe-return-flow-is-visible-and-can-be-finalized-after-login-instead-of-being-stuck-on-the-login-screen",
      "title": "Handle Stripe success return parameters (`beatId`, `rightsType`, `session_id`) even when the user is not authenticated, so the Stripe return flow is visible and can be finalized after login instead of being stuck on the login screen.",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-add-clear-user-facing-ui-feedback-during-stripe-return-handling-so-users-can-see-what-is-happening-redirecting-to-purchase-history-and-or-completing-the-purchase",
      "title": "Add clear user-facing UI feedback during Stripe return handling so users can see what is happening (redirecting to purchase history and/or completing the purchase).",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-paid-beat-purchases-always-redirect-the-browser-to-a-valid-stripe-checkout-url-after-createcheckoutsession-returns-and-never-silently-fail-without-user-visible-feedback",
      "title": "Ensure paid beat purchases always redirect the browser to a valid Stripe Checkout URL after `createCheckoutSession` returns, and never silently fail without user-visible feedback.",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-stripe-configuration-preflight-in-the-purchase-ui-when-stripe-is-not-configured-isstripeconfigured-is-false-disable-paid-purchase-buttons-and-show-an-english-message-explaining-that-checkout-is-unavailable-until-stripe-is-configured",
      "title": "Add a Stripe configuration preflight in the purchase UI: when Stripe is not configured (`isStripeConfigured` is false), disable paid purchase buttons and show an English message explaining that checkout is unavailable until Stripe is configured.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-frontend-debugging-signals-for-checkout-initiation-failures-by-logging-structured-details-to-the-console-e-g-which-beatid-rightstype-whether-stripe-configured-and-whether-a-checkout-url-was-returned-without-logging-any-secrets",
      "title": "Improve frontend debugging signals for checkout initiation failures by logging structured details to the console (e.g., which beatId/rightsType, whether Stripe configured, and whether a checkout URL was returned) without logging any secrets.",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-purchase-ui-across-beat-cards-and-beat-details-pages-to-reflect-licensing-rules-label-basic-premium-and-stem-pack-as-non-exclusive-show-buyer-facing-text-non-exclusive-licenses-allow-multiple-artists-to-license-this-beat-and-stems-until-exclusive-rights-are-purchased-and-include-the-legal-clause-licensor-retains-the-right-to-license-the-beat-and-stem-files-to-third-parties-until-exclusive-rights-are-purchased",
      "title": "Update frontend purchase UI across beat cards and beat details pages to reflect licensing rules: label Basic, Premium, and Stem Pack as “Non-Exclusive”; show buyer-facing text: “Non-exclusive licenses allow multiple artists to license this beat and stems until exclusive rights are purchased.”; and include the legal clause: “Licensor retains the right to license the beat and stem files to third parties until exclusive rights are purchased.”",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-availability-sold-state-messaging-and-listing-behavior-to-match-backend-exclusive-sale-rules-when-exclusive-is-sold-for-a-beat-show-exclusive-sold-disable-purchase-buttons-for-basic-premium-stems-and-ensure-the-beat-is-not-shown-in-public-store-listings",
      "title": "Update frontend availability, sold-state messaging, and listing behavior to match backend Exclusive-sale rules: when Exclusive is sold for a beat, show “Exclusive – Sold”, disable purchase buttons for Basic/Premium/Stems, and ensure the beat is not shown in public store listings.",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-licensing-availability-logic-so-basic-premium-and-stem-pack-non-exclusive-never-become-disabled-greyed-out-due-to-any-per-folder-sold-flag-only-disable-purchase-options-when-the-beat-is-exclusive-sold-and-only-treat-sold-as-meaningful-for-the-exclusive-rights-type",
      "title": "Update frontend licensing availability logic so Basic, Premium, and Stem Pack (non-exclusive) never become disabled/greyed-out due to any per-folder `sold` flag; only disable purchase options when the beat is Exclusive-sold, and only treat `sold` as meaningful for the Exclusive rights type.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-frontend-src-lib-beatrights-ts-so-canpurchaserights-and-any-sold-availability-helpers-do-not-use-per-rights-sold-flags-to-block-non-exclusive-purchases-basic-premium-stems-only-block-purchases-when-the-beat-is-exclusive-sold-exclusive-folder-sold-true",
      "title": "Fix `frontend/src/lib/beatRights.ts` so `canPurchaseRights` and any sold/availability helpers do not use per-rights `sold` flags to block non-exclusive purchases (Basic/Premium/Stems). Only block purchases when the beat is Exclusive-sold (Exclusive folder `sold = true`).",
      "reqIds": [
        "REQ-33"
      ],
      "version": 1
    },
    {
      "id": "feature-retry-the-full-project-build-and-deployment-if-deployment-fails-capture-and-present-the-complete-build-deploy-error-output-including-canister-compilation-errors-install-upgrade-errors-and-frontend-asset-upload-errors-so-the-failure-is-actionable-to-debug",
      "title": "Retry the full project build and deployment. If deployment fails, capture and present the complete build/deploy error output (including canister compilation errors, install/upgrade errors, and frontend asset upload errors) so the failure is actionable to debug.",
      "reqIds": [
        "REQ-36"
      ],
      "version": 1
    },
    {
      "id": "feature-retry-the-full-project-build-and-deployment-if-deployment-fails-capture-and-present-the-complete-build-deploy-error-output-including-canister-compilation-errors-install-upgrade-errors-and-frontend-asset-upload-errors-so-the-failure-is-actionable-to-debug-use-the-existing-log-capture-scripts-under-frontend-scripts-or-equivalent-to-ensure-stdout-and-stderr-are-preserved-end-to-end",
      "title": "Retry the full project build and deployment. If deployment fails, capture and present the complete build/deploy error output (including canister compilation errors, install/upgrade errors, and frontend asset upload errors) so the failure is actionable to debug. Use the existing log-capture scripts under `frontend/scripts/` (or equivalent) to ensure stdout and stderr are preserved end-to-end.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-wire-the-admin-analytics-dashboard-to-fetch-analytics-data-from-the-backend-getanalytics-method-and-render-the-returned-counters-total-site-visits-and-per-page-visit-counts-instead-of-showing-an-empty-dashboard",
      "title": "Wire the Admin Analytics dashboard to fetch analytics data from the backend `getAnalytics` method and render the returned counters (total site visits and per-page visit counts) instead of showing an empty dashboard.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-frontend-analytics-data-model-handling-is-resilient-to-missing-empty-fields-returned-by-the-backend-so-the-admin-analytics-page-never-renders-blank-due-to-null-undefined-access-e-g-missing-dailyvisits-or-missing-keys-inside-pagevisits",
      "title": "Ensure the frontend analytics data model handling is resilient to missing/empty fields returned by the backend so the Admin Analytics page never renders blank due to `null`/`undefined` access (e.g., missing `dailyVisits` or missing keys inside `pageVisits`).",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-admin-analytics-ui-frontend-src-components-analyticssection-tsx-to-display-an-additional-excluding-me-view-of-analytics-total-visits-excluding-the-current-admin-unique-visitors-excluding-the-current-admin-and-per-page-counts-excluding-the-current-admin",
      "title": "Update the Admin Analytics UI (frontend/src/components/AnalyticsSection.tsx) to display an additional “Excluding me” view of analytics: total visits excluding the current admin, unique visitors excluding the current admin, and per-page counts excluding the current admin.",
      "reqIds": [
        "REQ-42"
      ],
      "version": 1
    },
    {
      "id": "feature-add-admin-ui-controls-within-the-analytics-section-to-allow-the-current-admin-to-exclude-or-include-their-own-principal-from-analytics-counting-a-single-click-toggle-and-show-the-current-status",
      "title": "Add Admin UI controls within the Analytics section to allow the current admin to exclude or include their own principal from analytics counting (a single-click toggle), and show the current status.",
      "reqIds": [
        "REQ-43"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-frontend-query-hooks-types-support-the-new-analytics-response-shape-used-to-render-both-overall-analytics-and-excluding-me-analytics-without-runtime-errors",
      "title": "Ensure frontend query hooks/types support the new analytics response shape used to render both overall analytics and “excluding me” analytics without runtime errors.",
      "reqIds": [
        "REQ-44"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-zip-based-beat-deliveries-automatically-include-the-correct-stored-license-document-basic-premium-exclusive-stems-when-a-user-downloads-purchased-files-or-performs-a-free-download-so-buyers-receive-the-license-without-manual-bundling",
      "title": "Ensure ZIP-based beat deliveries automatically include the correct stored license document (Basic/Premium/Exclusive/Stems) when a user downloads purchased files or performs a free download, so buyers receive the license without manual bundling.",
      "reqIds": [
        "REQ-45"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-zip-download-flow-in-the-purchase-history-page-so-that-for-zip-delivered-beats-it-fetches-the-rights-zip-and-the-matching-license-document-then-downloads-a-single-zip-that-includes-the-license-document-automatically",
      "title": "Update the ZIP download flow in the Purchase History page so that for ZIP-delivered beats it fetches the rights ZIP and the matching license document, then downloads a single ZIP that includes the license document automatically.",
      "reqIds": [
        "REQ-47"
      ],
      "version": 1
    },
    {
      "id": "feature-update-any-other-zip-download-entry-points-e-g-beat-details-or-beat-cards-so-that-immediate-downloads-after-purchase-free-download-also-include-the-matching-stored-license-document-in-the-downloaded-zip-consistent-with-the-purchase-history-behavior",
      "title": "Update any other ZIP download entry points (e.g., Beat details or Beat cards) so that immediate downloads after purchase/free download also include the matching stored license document in the downloaded ZIP, consistent with the Purchase History behavior.",
      "reqIds": [
        "REQ-48"
      ],
      "version": 1
    },
    {
      "id": "feature-retry-the-full-project-build-and-deployment-if-deployment-fails-capture-and-present-the-complete-build-deploy-output-stdout-and-stderr-including-any-canister-compilation-errors-install-upgrade-errors-and-frontend-asset-upload-errors-so-the-failure-is-actionable-to-debug-use-the-existing-log-capture-scripts-under-frontend-scripts-e-g-frontend-scripts-capture-deploy-output-sh-and-frontend-scripts-capture-deploy-output-ps1-or-equivalent-to-ensure-logs-are-preserved-end-to-end-and-include-the-saved-log-filepath-in-the-results",
      "title": "Retry the full project build and deployment. If deployment fails, capture and present the complete build/deploy output (stdout and stderr), including any canister compilation errors, install/upgrade errors, and frontend asset upload errors, so the failure is actionable to debug. Use the existing log-capture scripts under `frontend/scripts/` (e.g., `frontend/scripts/capture-deploy-output.sh` and `frontend/scripts/capture-deploy-output.ps1`) or equivalent to ensure logs are preserved end-to-end, and include the saved log filepath in the results.",
      "reqIds": [
        "REQ-49"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-purchase-history-page-frontend-src-pages-purchasehistorypage-tsx-so-that-each-purchased-rights-entry-offers-a-separate-download-license-action-that-downloads-the-correct-license-document-for-that-specific-beat-rightstype-purchase-in-addition-to-the-existing-beat-zip-google-drive-delivery-download",
      "title": "Update the Purchase History page (frontend/src/pages/PurchaseHistoryPage.tsx) so that each purchased rights entry offers a separate “Download License” action that downloads the correct license document for that specific beat + rightsType purchase (in addition to the existing beat ZIP / Google Drive delivery download).",
      "reqIds": [
        "REQ-50"
      ],
      "version": 1
    },
    {
      "id": "feature-add-clear-user-facing-feedback-on-the-purchase-history-page-during-license-download-loading-state-on-the-specific-purchase-row-and-on-failure-english-toast-or-inline-message",
      "title": "Add clear user-facing feedback on the Purchase History page during license download (loading state on the specific purchase row) and on failure (English toast or inline message).",
      "reqIds": [
        "REQ-52"
      ],
      "version": 1
    },
    {
      "id": "feature-retry-the-full-project-build-and-deployment-if-deployment-fails-capture-and-present-the-complete-build-deploy-output-stdout-and-stderr-including-any-backend-canister-compilation-errors-canister-install-upgrade-errors-and-frontend-asset-upload-errors-so-the-failure-is-actionable-to-debug-use-the-existing-log-capture-scripts-under-frontend-scripts-including-frontend-scripts-retry-deploy-with-capture-mjs-which-runs-capture-deploy-output-sh-or-capture-deploy-output-ps1-to-ensure-logs-are-preserved-end-to-end-and-include-the-saved-deployment-log-filepath-in-the-results",
      "title": "Retry the full project build and deployment. If deployment fails, capture and present the complete build/deploy output (stdout and stderr), including any backend canister compilation errors, canister install/upgrade errors, and frontend asset upload errors, so the failure is actionable to debug. Use the existing log-capture scripts under `frontend/scripts/` (including `frontend/scripts/retry-deploy-with-capture.mjs` which runs `capture-deploy-output.sh` or `capture-deploy-output.ps1`) to ensure logs are preserved end-to-end, and include the saved deployment log filepath in the results.",
      "reqIds": [
        "REQ-53"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-purchase-history-download-license-action-successfully-downloads-the-license-document-for-each-purchase-row-basic-premium-exclusive-stems-for-both-free-downloads-and-paid-purchases-using-the-existing-hook-usedownloadlicensefile-which-calls-actor-getlicensefiles-if-the-backend-returns-an-empty-list-show-an-english-user-facing-error-that-the-license-is-not-available-for-that-rights-type",
      "title": "Ensure the Purchase History “Download License” action successfully downloads the license document for each purchase row (Basic/Premium/Exclusive/Stems) for both free downloads and paid purchases, using the existing hook `useDownloadLicenseFile` (which calls `actor.getLicenseFiles`).\n\nIf the backend returns an empty list, show an English user-facing error that the license is not available for that rights type.",
      "reqIds": [
        "REQ-55"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-m-v-a-page-content-in-frontend-src-pages-mvapage-tsx-using-surgical-edits-only-keep-the-existing-design-colors-typography-layout-section-order-headings-and-tone-unchanged-except-for-the-specific-additions-edits-listed-in-req-57-through-req-59",
      "title": "Update the M.v.A page content in `frontend/src/pages/MvaPage.tsx` using surgical edits only: keep the existing design, colors, typography, layout, section order, headings, and tone unchanged except for the specific additions/edits listed in REQ-57 through REQ-59.",
      "reqIds": [
        "REQ-56"
      ],
      "version": 1
    },
    {
      "id": "feature-insert-two-new-sections-immediately-after-the-existing-section-titled-how-m-v-a-beats-are-built-and-before-the-next-existing-section-currently-modular-beat-system-diagram-the-two-new-sections-must-be-added-with-the-exact-titles-and-verbatim-body-content-provided-by-the-user-without-paraphrasing-or-reformatting-the-wording",
      "title": "Insert two NEW sections immediately after the existing section titled “How M.v.A Beats Are Built” and before the next existing section (currently “Modular Beat System Diagram”). The two new sections must be added with the exact titles and verbatim body content provided by the user, without paraphrasing or reformatting the wording.",
      "reqIds": [
        "REQ-57"
      ],
      "version": 1
    },
    {
      "id": "feature-apply-the-required-sentence-phrase-level-edits-in-frontend-src-pages-mvapage-tsx-exactly-as-specified-by-the-user-without-altering-any-other-text-in-those-sections-a-in-section-what-is-m-v-a-replace-only-the-main-definition-sentence-with-m-v-a-modular-verse-architect-is-a-flow-driven-hip-hop-production-system-where-a-fixed-melodic-identity-is-preserved-while-verses-evolve-through-modular-drum-808-and-melodic-modulation-without-adding-new-instruments-b-in-section-how-m-v-a-beats-are-built-verse-step-replace-the-phrase-same-melody-continues-with-same-melodic-identity-continues-c-in-section-what-makes-m-v-a-different-melody-consistency-bullet-replace-only-the-bullet-description-text-with-the-melodic-identity-remains-recognizable-throughout-the-track-even-as-it-is-modulated-across-sections-do-not-change-the-bullet-title-melody-consistency-d-in-section-how-to-rap-on-m-v-a-beats-replace-the-phrase-constant-reference-point-with-core-reference-point-e-in-section-m-v-a-philosophy-replace-the-sentence-referencing-keeping-the-melody-consistent-with-by-preserving-melodic-identity-while-evolving-drums-808s-and-melodic-modulation-m-v-a-provides-cohesive-flexibility-for-artists",
      "title": "Apply the required sentence/phrase-level edits in `frontend/src/pages/MvaPage.tsx` exactly as specified by the user, without altering any other text in those sections:\nA) In section “What Is M.v.A?”, replace only the main definition sentence with: “M.v.A (Modular Verse Architect) is a flow-driven hip-hop production system where a fixed melodic identity is preserved while verses evolve through modular drum, 808, and melodic modulation — without adding new instruments.”\nB) In section “How M.v.A Beats Are Built” (Verse step), replace the phrase “Same melody continues” with “Same melodic identity continues”.\nC) In section “What Makes M.v.A Different” (Melody Consistency bullet), replace only the bullet description text with: “The melodic identity remains recognizable throughout the track, even as it is modulated across sections.” Do not change the bullet title “Melody Consistency:”.\nD) In section “How to Rap on M.v.A Beats”, replace the phrase “constant reference point” with “core reference point”.\nE) In section “M.v.A Philosophy”, replace the sentence referencing “keeping the melody consistent” with: “By preserving melodic identity while evolving drums, 808s, and melodic modulation, M.v.A provides cohesive flexibility for artists.”",
      "reqIds": [
        "REQ-58"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-one-line-definition-text-in-frontend-src-pages-mvapage-tsx-with-the-exact-line-provided-by-the-user-verbatim-m-v-a-is-a-flow-driven-hip-hop-production-style-where-a-fixed-melodic-identity-is-preserved-while-verses-evolve-through-modular-drum-808-and-melodic-modulation-without-adding-new-instruments",
      "title": "Replace the “One-Line Definition” text in `frontend/src/pages/MvaPage.tsx` with the exact line provided by the user (verbatim): “M.v.A is a flow-driven hip-hop production style where a fixed melodic identity is preserved while verses evolve through modular drum, 808, and melodic modulation—without adding new instruments.”",
      "reqIds": [
        "REQ-59"
      ],
      "version": 1
    },
    {
      "id": "feature-respect-the-explicit-do-not-change-boundaries-for-the-m-v-a-page-do-not-modify-the-introduction-quotes-diagram-explanation-diagram-section-who-m-v-a-is-for-preview-section-about-the-creator-trademark-use-notice-or-cta-browse-beats-section-and-do-not-change-any-other-sections-not-explicitly-listed-for-edits",
      "title": "Respect the explicit “do not change” boundaries for the M.v.A page: do not modify the Introduction, Quotes, Diagram explanation/diagram section, “Who M.v.A Is For”, Preview section, “About the Creator”, “Trademark & Use Notice”, or CTA/Browse Beats section (and do not change any other sections not explicitly listed for edits).",
      "reqIds": [
        "REQ-60"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-forum-message-display-in-the-section-detail-page-frontend-src-pages-sectiondetailpage-tsx-so-that-each-message-shows-the-user-s-saved-profile-name-as-the-author-name-instead-of-displaying-the-principal-or-an-anonymous-unauthenticated-fallback",
      "title": "Update the forum message display in the Section Detail page (frontend/src/pages/SectionDetailPage.tsx) so that each message shows the user's saved profile name as the author name instead of displaying the principal or an anonymous/unauthenticated fallback.",
      "reqIds": [
        "REQ-62"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-forum-message-display-component-in-frontend-src-pages-sectiondetailpage-tsx-so-that-each-message-renders-the-author-s-profile-name-from-the-authorname-field-as-the-visible-author-label-instead-of-displaying-the-principal-id-if-authorname-is-null-or-empty-fall-back-to-displaying-anonymous-as-the-author-name-do-not-display-the-principal-id-to-end-users",
      "title": "Update the forum message display component in `frontend/src/pages/SectionDetailPage.tsx` so that each message renders the author's profile name (from the `authorName` field) as the visible author label instead of displaying the principal ID. If `authorName` is null or empty, fall back to displaying 'Anonymous' as the author name. Do not display the principal ID to end users.",
      "reqIds": [
        "REQ-65"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-message-type-definition-and-query-hook-usegetmessagesinsection-to-include-the-new-authorname-string-null-field-in-the-message-data-structure-ensuring-type-safety-across-the-forum-message-rendering-components",
      "title": "Update the frontend message type definition and query hook (`useGetMessagesInSection`) to include the new `authorName?: string | null` field in the message data structure, ensuring type safety across the forum message rendering components.",
      "reqIds": [
        "REQ-66"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Fix Stripe paid purchase flow: stop using fake sessionId; create real Stripe Checkout Session server-side, redirect to Stripe, then on success/callback verify the real session and only then call recordBeatPurchase (so paid purchases no longer fail with 'Payment not complete: cannot record purchase - stripe API error').",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Make backend purchase recording tolerant of duplicate recording attempts for the same principal and beat (e.g., due to user refresh), so it does not create duplicate entries in `purchases` for the same beatId.",
      "reqIds": [
        "REQ-5"
      ],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Keep backend purchase recording behavior consistent with the corrected Stripe flow: paid purchases must be recorded only after `Stripe.getSessionStatus(sessionId)` returns `#completed` in `recordBeatPurchase` (backend/main.mo). Do not add any new paid-purchase bypasses that would allow recording without a completed Stripe session.",
      "reqIds": [
        "REQ-11"
      ],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Fix Stripe post-checkout redirect Not Found: ensure `successUrl`/`cancelUrl` point to an existing SPA route (e.g. add/wire `/stripe-success` handler) and include `session_id={CHECKOUT_SESSION_ID}` so the return page can record/verify the purchase.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Deployment/credit usage policy: do not trigger builds or live deployments unless the user explicitly requests it; clarify which action will consume credits before running it.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Retry the full project build and deployment. If deployment fails again, capture and present the complete build/deploy error output (including any canister compilation errors, install/upgrade errors, or frontend asset upload errors) so the failure is actionable to debug.",
      "reqIds": [
        "REQ-15"
      ],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "Verify and fix the backend `createCheckoutSession` return value so it returns a Stripe Checkout URL suitable for `window.location.href` (not a session id or empty string for paid items), and provide actionable error messages when Stripe session creation fails.",
      "reqIds": [
        "REQ-20"
      ],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Implement beat licensing logic: Basic/Premium/Stems are non-exclusive and remain purchasable by multiple customers; only Exclusive removes beat from sale (mark \"Exclusive – Sold\", hide from public listings, block all other purchases). Exclusive purchase must include stems automatically, keep prior non-exclusive purchases valid, and update buyer-facing/ legal license text consistently across beat pages, checkout, delivery, and license records.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Update backend beat-rights sold-state logic so that only an Exclusive license purchase can mark a beat as sold and remove it from public sale: Basic, Premium, and Stem Pack purchases must be treated as non-exclusive and must never mark those rights as sold or otherwise remove the beat from sale.",
      "reqIds": [
        "REQ-22"
      ],
      "status": "pending"
    },
    {
      "id": "AR-20",
      "summary": "Enforce Exclusive-sale purchase blocking rules in backend purchase recording: once Exclusive rights for a beat are sold, reject any new Basic, Premium, or Stem Pack purchases for that beat; also reject any additional Exclusive purchase attempts.",
      "reqIds": [
        "REQ-23"
      ],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Change backend public store listing behavior so beats that are “Exclusive – Sold” are removed from public listings, while still allowing admins to manage them and allowing existing buyers to access their purchased files/licenses.",
      "reqIds": [
        "REQ-24"
      ],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Implement license record semantics in backend so purchases are recorded per beat AND per rights type (Basic/Premium/Stems/Exclusive) rather than only storing `beatId`, and ensure previously recorded purchases remain valid after upgrade.",
      "reqIds": [
        "REQ-25"
      ],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Update backend file-delivery authorization so that Exclusive buyers automatically have access to full multitrack stems at no additional cost: if a purchaser has an Exclusive license for a beat, then requests for Stem Pack delivery for that beat must succeed even if the user never purchased the Stem Pack separately.",
      "reqIds": [
        "REQ-26"
      ],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Fix free Basic download UI/state: after downloading a free Basic license, the UI should not grey out/disable Basic (and should reflect correct non-exclusive availability/download access) so users can still interact and others can still purchase/download per rules.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Fix backend rights sold-state enforcement so non-exclusive purchases (Basic, Premium, Stems), including free Basic downloads, never mark those rights as sold and never block future non-exclusive purchases; only an Exclusive purchase may mark a beat as sold (Exclusive folder `sold = true`) and block subsequent purchases.",
      "reqIds": [
        "REQ-30"
      ],
      "status": "pending"
    },
    {
      "id": "AR-27",
      "summary": "On upgrade, repair any existing beat data where Basic/Premium/Stems rights folders were incorrectly marked `sold = true` (likely caused by prior free downloads or prior purchase recording), by resetting `sold = false` for all non-exclusive rights types while leaving Exclusive sold state unchanged.",
      "reqIds": [
        "REQ-31"
      ],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "Update frontend licensing availability logic so Basic, Premium, and Stem Pack rights never appear as sold/disabled due to any per-folder `sold` flag. Only treat `sold` as meaningful for the Exclusive rights type: when Exclusive is sold, show “Exclusive – Sold” and disable/hide other purchase options; otherwise keep Basic/Premium/Stems purchasable/active.",
      "reqIds": [
        "REQ-32"
      ],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Update backend purchase recording and rights sold-state enforcement so only an Exclusive purchase can ever set a beat’s rights folder `sold = true` and block future purchases. Basic, Premium, and Stem Pack purchases (including free Basic downloads) must never mark any folder as sold and must never block future non-exclusive purchases.",
      "reqIds": [
        "REQ-34"
      ],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Add an upgrade-safe repair for existing beat data where non-exclusive rights folders (Basic/Premium/Stems) were incorrectly marked `sold = true` from prior purchases/downloads. On upgrade, reset `sold = false` for all non-exclusive rights types while leaving Exclusive sold state unchanged.",
      "reqIds": [
        "REQ-35"
      ],
      "status": "pending"
    },
    {
      "id": "AR-32",
      "summary": "Implement YouTube Live URL management end-to-end: add backend storage and Candid methods to set/get/delete the YouTube livestream URL (so useGetYouTubeLiveUrl no longer returns null and set/delete no longer throw), and wire the Admin Live configuration UI to persist and reflect the saved value on the public Live page.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-33",
      "summary": "Fix analytics dashboard: wire the Admin Analytics page frontend to fetch `getAnalytics` from the backend and display total site visits and per-page visit counters (and any existing stored analytics fields) so the dashboard reflects recorded data.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-36",
      "summary": "Verify the backend canister exposes a `getAnalytics` query that returns the same fields the frontend expects (at least `totalVisits`, `uniqueVisitors`, `dailyVisits`, and `pageVisits` with keys used by the UI), and adjust the backend return shape if needed so the Admin Analytics dashboard can display recorded analytics.",
      "reqIds": [
        "REQ-40"
      ],
      "status": "pending"
    },
    {
      "id": "AR-37",
      "summary": "Add analytics option/section to exclude the admin/owner’s own visits from visitor counts (show \"all visitors minus me\"), so the dashboard can display non-self total visits/unique visitors/page visits based on the current user’s principal (or a configurable excluded principal list).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-38",
      "summary": "Add backend support to exclude specific principals (starting with the current admin/owner) from analytics counting, so the Admin Analytics dashboard can show “all visitors minus me” counts.",
      "reqIds": [
        "REQ-41"
      ],
      "status": "pending"
    },
    {
      "id": "AR-39",
      "summary": "Auto-include the correct license document (Basic/Premium/Exclusive/Stems) with customer delivery: when a rights ZIP is delivered/downloaded after purchase or free download, automatically attach/embed the matching stored license PDF so buyers receive the license file without manual bundling.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-41",
      "summary": "Update backend license retrieval for downloads so the frontend can always fetch the correct stored license document for a given beat+rightsType during download (including authorization checks consistent with ZIP delivery authorization).",
      "reqIds": [
        "REQ-46"
      ],
      "status": "pending"
    },
    {
      "id": "AR-43",
      "summary": "Implement/verify a backend Candid method used by the frontend hook `useGetLicenseFiles(beatId, rightsType, sessionId)` so that it reliably returns the correct license document(s) for a given beat + rightsType to authorized purchasers (including free downloads and guest purchases using sessionId), and returns an empty list when no license is configured for that rightsType.",
      "reqIds": [
        "REQ-51"
      ],
      "status": "pending"
    },
    {
      "id": "AR-44",
      "summary": "Implement or fix the backend Candid method `getLicenseFiles(beatId, rightsType, sessionId)` so the frontend can download the correct stored license document(s) for a specific beat + rights type for both free downloads and paid purchases.\n\nThe method must:\n- Accept `beatId : Text`, `rightsType : RightsType`, `sessionId : ?Text`.\n- Enforce authorization consistent with existing delivery authorization rules (admins always allowed; authenticated purchasers allowed; guests allowed only when a valid `sessionId` is provided and the session is verified for that beat).\n- Return the license file(s) as `[Storage.ExternalBlob]` (empty array when no license is configured for that rights type) instead of trapping for the “not configured” case.\n- Select the license document from the correct rights-type store (Basic/Premium/Exclusive/Stems), matching the rights type requested.",
      "reqIds": [
        "REQ-54"
      ],
      "status": "pending"
    },
    {
      "id": "AR-45",
      "summary": "M.v.A page content update (no design/theme changes): add two new sections after “How M.v.A Beats Are Built” (Melody Modulation Rule; Why M.v.A Uses Modulation…), and apply the specified sentence/phrase replacements in: What Is M.v.A?, How M.v.A Beats Are Built (Verse step), What Makes M.v.A Different (Melody Consistency bullet description only), How to Rap on M.v.A Beats, M.v.A Philosophy, and One-Line Definition. Changes must be prepared as drafts only; do not go live unless the user explicitly instructs.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-51",
      "summary": "Draft-only workflow: do not run a build, deploy, or “go live” action as part of implementing these M.v.A page updates. Changes should be left in a reviewable draft state until the user explicitly requests deployment.",
      "reqIds": [
        "REQ-61"
      ],
      "status": "pending"
    },
    {
      "id": "AR-52",
      "summary": "Display user profile name (from saved user profile) as the message author name in forum messages instead of principal or anonymous/unauthenticated fallback.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-54",
      "summary": "Update the backend forum message data structure and retrieval method so that when messages are fetched for a section, each message includes the author's saved profile name (if available) in addition to the principal, so the frontend can display the correct author name without separate profile lookups.",
      "reqIds": [
        "REQ-63"
      ],
      "status": "pending"
    },
    {
      "id": "AR-55",
      "summary": "Update the backend forum message retrieval method (`getMessagesInSection`) so that when fetching messages for a section, each returned message includes the author's saved profile name (from the user's profile data) in addition to the principal. Add a new field `authorName : ?Text` to the returned message structure that contains the user's profile name if available, or null if the user has no saved profile or the message was posted anonymously.",
      "reqIds": [
        "REQ-64"
      ],
      "status": "pending"
    },
    {
      "id": "AR-56",
      "summary": "Update the forum message display in the Section Detail page (frontend/src/pages/SectionDetailPage.tsx) so that when rendering each message, it shows the author's saved profile name (from the `authorName` field already present in the message data structure) instead of displaying 'Anonymous' for users who have a profile. If `authorName` is null or empty, fall back to displaying 'Anonymous'. Do not display the principal ID to end users.",
      "reqIds": [
        "REQ-67"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "MikupBeats",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}